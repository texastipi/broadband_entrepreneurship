<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Dataset Preparation</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link href="site_libs/ionicons-2.0.1/css/ionicons.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Broadband & Entrepreneurship</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="dataset-prep.html">Dataset Prep</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="ion ion-bar-chart-sharp"></span>
     
    Measurements
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="broadband-measure.html">Broadband</a>
    </li>
    <li>
      <a href="entrepreneurship-measure.html">Entrepreneurship</a>
    </li>
    <li>
      <a href="fcc-broadband-replicate.html">FCC Broadband Availability</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="regression-analyses.html">Regression Models</a>
    </li>
    <li>
      <a href="metro_non-metro-comparison.html">Metro/Non-Metro Comparison</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Dataset Preparation</h1>

</div>


<p>This document lays out the data handling process of multiple databases related to broadband availability, speed, and entrepreneurship of Texas, Maine, and Kansas. Databases used here are as follows:</p>
<ul>
<li>Microsoft Broadband Availability Dataset</li>
<li>Measurement Lab (M-Lab) Datasets Exported via Google BigQuery</li>
<li>GoDaddy Venture Density &amp; Demographic Dataset</li>
<li>Texas Sole Proprietors Data</li>
<li>IRR Rural Index</li>
</ul>
<p>In the following sections, I will import, clean, and set up the aforementioned datasets to be joined by <em>county</em>.</p>
<p>Install and call packages used for the folloiwng process.</p>
<pre class="r"><code>rm(list = ls())   ## Clear the workspace


#install.packages(&quot;tidyverse&quot;)
#install.packages(&quot;ggplot2&quot;)
library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────────────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.2     ✓ purrr   0.3.4
## ✓ tibble  3.0.3     ✓ dplyr   1.0.1
## ✓ tidyr   1.1.1     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(ggplot2)</code></pre>
<hr />
<div id="microsoft-broadband-availability-dataset" class="section level2">
<h2>Microsoft Broadband Availability Dataset</h2>
<p>Microsoft dataset is available in its <a href="https://github.com/microsoft/USBroadbandUsagePercentages">GitHub repository</a>. Therefore, we will directly import its dataset from the URL.</p>
<p>Note that the percentage variables are imported as factors. We need them to be in the form of integers. Converting factors directly to numeric vectors using <code>as.numeric()</code> would result in loss of information. Following the methods suggested <a href="https://stackoverflow.com/a/3418192/11199930">here</a>, the code below converts <code>BROADBAND.AVAILABILITY.PER.FCC</code> and <code>BROADBAND.USAGE</code> to numeric values.</p>
<pre class="r"><code>## Create new variabes in numeric form
ms_broadband &lt;- ms_broadband %&gt;% 
  rename(pct_broadband_FCC = `BROADBAND AVAILABILITY PER FCC`,
         pct_broadband_MS = `BROADBAND USAGE`)

## Confirm the change
str(ms_broadband)</code></pre>
<p>Next step is to filter out information on the states other than Texas</p>
<pre class="r"><code>## Filtering TX
ms_broadband_txksme &lt;- ms_broadband %&gt;% 
  filter(ST == &quot;TX&quot; | ST == &quot;KS&quot; | ST == &quot;ME&quot;) %&gt;% droplevels() # Deletes unused levels in factor variables in a dataset

## Inspect the result
str(ms_broadband_txksme)</code></pre>
</div>
<div id="godaddy-dataset" class="section level2">
<h2>GoDaddy Dataset</h2>
<p>The GoDaddy dataset has been used by researchers (Mossberger, Tolbert, &amp; LaCombe, 2020) for studying local entrepreneurship represented by actual adoption and usage of the Internet. The dataset includes venture density variables in various time frames. Furthermore, the dataset includes numbers of important demographic/economic factors derived from the American Community Survey estimates.</p>
<p>In the following section, I will import, inspect and set up the dataset for further join with other databases.</p>
<pre class="r"><code>## Import the Dataset
godaddy_cbsa &lt;- read.csv(&quot;https://raw.githubusercontent.com/jwroycechoi/broadband-entrepreneurship/master/Datasets/GoDaddy_CBSA.csv&quot;, header = T)    # GoDaddy dataset at the unit of Core Based Statistical Area (CBSA) defined by U.S. Department of Housing and Urban Development
godaddy_county &lt;- read.csv(&quot;https://raw.githubusercontent.com/jwroycechoi/broadband-entrepreneurship/master/Datasets/GoDaddy_County.csv&quot;, header = T)    # GoDaddy dataset at the county level

## Inspect Structure
str(godaddy_cbsa)
str(godaddy_county)</code></pre>
<p>The GoDaddy dataset also has to be filtered to include only Texas data. Since we are at the moment only interested in county level information, the filtering will only be conducted to the county level dataset. The county level dataset has a variable named <code>cfips</code>, which is a FIPS code. FIPS code idnetifies Texas by the <a href="https://www.dshs.texas.gov/chs/info/info_txco.shtm">first two digit: ‘48’</a>.</p>
<pre class="r"><code>## Filtering Texas using FIPS code
str(godaddy_county)

godaddy_county_txksme &lt;- godaddy_county %&gt;% 
  filter(startsWith(as.character(cfips), &quot;48&quot;) | startsWith(as.character(cfips), &quot;23&quot;) |
           startsWith(as.character(cfips), &quot;20&quot;)) %&gt;% # Filter Texas, Kansas, Maine
  mutate(population = as.numeric(gsub(&quot;,&quot;,&quot;&quot;,as.character(population)))) %&gt;% # Convert population from factor to numeric
  separate(county, into = c(&quot;county&quot;, &quot;state&quot;), sep = &quot;, &quot;, remove = T) %&gt;% # Separate county variable which had state and county data at the same time
  droplevels()  # Drop unused levels from factor variables

## Inspect Structure
str(godaddy_county_txksme)</code></pre>
</div>
<div id="m-lab-datasets" class="section level2">
<h2>M-Lab Datasets</h2>
<p>Measurement Lab (M-Lab) datasets consists of user reported download (DL) and upload (UL) speed by geographical information. The easiest way to access and retrieve data from the database is by making queries via Google BigQuery platform using Standard SQL statements. You can find more about datasets available from M-Lab and overview <a href="https://www.measurementlab.net/data/">here</a>. Currently M-Lab suggests using the <em>Unified View</em> dataset to researchers. The datasets from the following time frames are retrieved through BigQuery using SQL statements shared by M-Lab team modified to match the time frames. The SQL queries and an overview of the methods of calculating median speeds are available <a href="https://datastudio.google.com/u/0/reporting/1djtGEuqV4Qwrj26GQTN_xzp3rsMYYcmv/page/s0CPB?s=rzD5rHYkLT4">here</a>. I made some simple modifications calculating the proportion of people who have recorded median speed of 25Mbps download/3Mbps upload in a given time period, which would align better with FCC’s broadband definition. The actual query used is available <a href="https://github.com/jwroycechoi/broadband-entrepreneurship/blob/master/Codes/25-3-BB-Query.sql">here</a>.</p>
<ul>
<li>September 2019</li>
<li>October 2019</li>
<li>November 2019</li>
<li>December 2019</li>
</ul>
<p>These time frames are initially selected because it matches the ones provided in the GoDaddy dataset. GoDaddy dataset provides venture density information in several time frame. While there are several time frames in 2018, the intervals are inconsistent. Since the time frames of 2019 are equally distanced (i.e., monthly) from September to December, this time frame was initially selected for M-Lab data retrieval.</p>
<p>In this section, I will import the retrieved M-Lab datasets and clean them.</p>
<pre class="r"><code>## Import the Dataset
mlab_sept &lt;- read.csv(&quot;https://raw.githubusercontent.com/jwroycechoi/broadband-entrepreneurship/master/Datasets/Mlab_State_All_Sept_2019_2.csv&quot;, header = T)
mlab_oct &lt;- read.csv(&quot;https://raw.githubusercontent.com/jwroycechoi/broadband-entrepreneurship/master/Datasets/Mlab_State_All_Oct_2019_2.csv&quot;, header = T)
mlab_nov &lt;- read.csv(&quot;https://raw.githubusercontent.com/jwroycechoi/broadband-entrepreneurship/master/Datasets/Mlab_State_All_Nov_2019_2.csv&quot;, header = T)
mlab_dec &lt;- read.csv(&quot;https://raw.githubusercontent.com/jwroycechoi/broadband-entrepreneurship/master/Datasets/Mlab_State_All_Dec_2019_2.csv&quot;, header = T)

## Inspect Structure
str(mlab_sept)
str(mlab_oct)
str(mlab_nov)
str(mlab_dec)

#### Cleaning and Filtering the Dataset ####
county_db &lt;- tidycensus::fips_codes
county_tx &lt;- county_db[which(county_db$state == &quot;TX&quot;), ]
county_ks &lt;- county_db[which(county_db$state == &quot;KS&quot;), ]
## September 2019 ##
mlab_sept_txksme &lt;- mlab_sept %&gt;% 
  filter(state == &quot;TX&quot; | state == &quot;KS&quot; | state == &quot;ME&quot;) %&gt;% 
  select(-c(&quot;BB_state&quot;,&quot;BB_county_name&quot;,&quot;DLmed_state&quot;,&quot;DLmed_county_name&quot;,&quot;ULmed_state&quot;,&quot;ULmed_county_name&quot;,&quot;ul_sample_state&quot;,&quot;ul_sample_county_name&quot;,&quot;dl_sample_state&quot;,&quot;dl_sample_county_name&quot;)) %&gt;% 
  mutate(county = paste(as.character(county_name), &quot;County&quot;, sep = &quot; &quot;),
         frac_over_25DL = 1 - frac_under_25mbpsDL) %&gt;% 
  droplevels() %&gt;% 
  left_join(., county_db, by = c(&quot;state&quot; = &quot;state&quot;, &quot;county&quot; = &quot;county&quot;)) %&gt;% 
  mutate(county_FIPS = paste0(state_code, county_code)) %&gt;% 
  select(-c(&quot;state_name&quot;,&quot;county_name&quot;))

## October 2019 ##
mlab_oct_txksme &lt;- mlab_oct %&gt;% 
  filter(state == &quot;TX&quot; | state == &quot;KS&quot; | state == &quot;ME&quot;) %&gt;% 
  select(-c(&quot;BB_state&quot;,&quot;BB_county_name&quot;,&quot;DLmed_state&quot;,&quot;DLmed_county_name&quot;,&quot;ULmed_state&quot;,&quot;ULmed_county_name&quot;,&quot;ul_sample_state&quot;,&quot;ul_sample_county_name&quot;,&quot;dl_sample_state&quot;,&quot;dl_sample_county_name&quot;)) %&gt;% 
  mutate(county = paste(as.character(county_name), &quot;County&quot;, sep = &quot; &quot;),
         frac_over_25DL = 1 - frac_under_25mbpsDL) %&gt;% 
  droplevels() %&gt;% 
  left_join(., county_db, by = c(&quot;state&quot; = &quot;state&quot;, &quot;county&quot; = &quot;county&quot;)) %&gt;% 
  mutate(county_FIPS = paste0(state_code, county_code)) %&gt;% 
  select(-c(&quot;state_name&quot;,&quot;county_name&quot;))

## November 2019 ##
mlab_nov_txksme &lt;- mlab_nov %&gt;% 
  filter(state == &quot;TX&quot; | state == &quot;KS&quot; | state == &quot;ME&quot;) %&gt;% 
  select(-c(&quot;BB_state&quot;,&quot;BB_county_name&quot;,&quot;DLmed_state&quot;,&quot;DLmed_county_name&quot;,&quot;ULmed_state&quot;,&quot;ULmed_county_name&quot;,&quot;ul_sample_state&quot;,&quot;ul_sample_county_name&quot;,&quot;dl_sample_state&quot;,&quot;dl_sample_county_name&quot;)) %&gt;% 
  mutate(county = paste(as.character(county_name), &quot;County&quot;, sep = &quot; &quot;),
         frac_over_25DL = 1 - frac_under_25mbpsDL) %&gt;% 
  droplevels() %&gt;% 
  left_join(., county_db, by = c(&quot;state&quot; = &quot;state&quot;, &quot;county&quot; = &quot;county&quot;)) %&gt;% 
  mutate(county_FIPS = paste0(state_code, county_code)) %&gt;% 
  select(-c(&quot;state_name&quot;,&quot;county_name&quot;))

## December 2019 ##
mlab_dec_txksme &lt;- mlab_dec %&gt;% 
  filter(state == &quot;TX&quot; | state == &quot;KS&quot; | state == &quot;ME&quot;) %&gt;% 
  select(-c(&quot;BB_state&quot;,&quot;BB_county_name&quot;,&quot;DLmed_state&quot;,&quot;DLmed_county_name&quot;,&quot;ULmed_state&quot;,&quot;ULmed_county_name&quot;,&quot;ul_sample_state&quot;,&quot;ul_sample_county_name&quot;,&quot;dl_sample_state&quot;,&quot;dl_sample_county_name&quot;)) %&gt;% 
  mutate(county = paste(as.character(county_name), &quot;County&quot;, sep = &quot; &quot;),
         frac_over_25DL = 1 - frac_under_25mbpsDL) %&gt;% 
  droplevels() %&gt;% 
  left_join(., county_db, by = c(&quot;state&quot; = &quot;state&quot;, &quot;county&quot; = &quot;county&quot;)) %&gt;% 
  mutate(county_FIPS = paste0(state_code, county_code)) %&gt;% 
  select(-c(&quot;state_name&quot;,&quot;county_name&quot;))</code></pre>
</div>
<div id="texas-sole-proprietors-dataset" class="section level2">
<h2>Texas Sole Proprietors Dataset</h2>
<p>This dataset contains information of sole proprietors number provided by the Bureau of Business Research at <span class="math inline">\(IC^{2}\)</span> Institute. The information is presented at the county level.</p>
<pre class="r"><code>## Import the Dataset
tx_proprietor &lt;- read_csv(&quot;https://raw.githubusercontent.com/jwroycechoi/broadband-entrepreneurship/master/Datasets/Sole-Proprietors-tx-combined.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   county = col_character(),
##   pct_change_proprietors_2000_2017 = col_double(),
##   proprietors_2000 = col_double(),
##   proprietors_2017 = col_double(),
##   pct_proprietors_employment_2000 = col_double(),
##   pct_proprietors_employment_2010 = col_double(),
##   pct_proprietors_employment_2017 = col_double(),
##   total_employment_2017 = col_double(),
##   wage_salary_jobs_2017 = col_double(),
##   pct_change_pro_emp_2000_2017 = col_double(),
##   pct_change_pro_emp_2010_2017 = col_double()
## )</code></pre>
<pre class="r"><code>## Inspect the Structure
str(tx_proprietor)</code></pre>
<p>This dataset’s variables are straighforward as it was pre-cleaned on Excel spreadsheet.</p>
</div>
<div id="irr-rural-index" class="section level2">
<h2>IRR Rural Index</h2>
<p>This dataset contains information of IRR index at the county level. The index calculates the extent to which a certain county could be considered as <em>‘rural’</em>. Smaller the value of the index, more rural the county is considered to be.</p>
<p>There are two datasets that contains data from 2000 and 2010. I will import these datasets, filter for Texas and set up for a final merge of all datasets we have.</p>
<pre class="r"><code>## Import the Dataset
rural_2000 &lt;- read_csv(&quot;https://raw.githubusercontent.com/jwroycechoi/broadband-entrepreneurship/master/Datasets/IRR-rural-2000.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   FIPS2000 = col_double(),
##   `County Name` = col_character(),
##   IRR2000 = col_double()
## )</code></pre>
<pre class="r"><code>rural_2010 &lt;- read_csv(&quot;https://raw.githubusercontent.com/jwroycechoi/broadband-entrepreneurship/master/Datasets/IRR-rural-2010.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   FIPS2010 = col_double(),
##   `County Name` = col_character(),
##   IRR2010 = col_double()
## )</code></pre>
<pre class="r"><code>## Inspect Structure
str(rural_2000)
str(rural_2010)

#### Clean the Datasets ####
## Filter Texas counties using FIPS code ##

rural_2000_txksme &lt;- rural_2000 %&gt;% 
  filter(startsWith(as.character(FIPS2000), &quot;48&quot;)| startsWith(as.character(FIPS2000), &quot;23&quot;) |
           startsWith(as.character(FIPS2000), &quot;20&quot;)) %&gt;% 
  separate(`County Name`, into = c(&quot;county&quot;, &quot;state&quot;), sep = &quot;, &quot;, remove = T)

rural_2010_txksme &lt;- rural_2010 %&gt;% 
  filter(startsWith(as.character(FIPS2010), &quot;48&quot;)| startsWith(as.character(FIPS2010), &quot;23&quot;) |
           startsWith(as.character(FIPS2010), &quot;20&quot;)) %&gt;% 
  separate(`County Name`, into = c(&quot;county&quot;, &quot;state&quot;), sep = &quot;, &quot;, remove = T)

## Inspect Structure
str(rural_2000_txksme)
str(rural_2010_txksme)</code></pre>
</div>
<div id="rural-urban-continuum-codes" class="section level2">
<h2>Rural-Urban Continuum Codes</h2>
<p>In addition to the IRR index, I also import the <a href="https://www.ers.usda.gov/data-products/rural-urban-continuum-codes.aspx">Rural-Urban Continuum Codes</a> (RUCC, 2013). The RUCC forms a classification scheme that distinguishes metropolitan counties by the population size of their metro area, and nonmetropolitan counties by degree of urbanization and adjacency to a metro area.</p>
<pre class="r"><code>rucc2013 &lt;- read_csv(&quot;https://raw.githubusercontent.com/jwroycechoi/broadband-entrepreneurship/master/Datasets/ruralurbancodes2013.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   FIPS = col_character(),
##   State = col_character(),
##   County_Name = col_character(),
##   Population_2010 = col_number(),
##   RUCC_2013 = col_double(),
##   Description = col_character()
## )</code></pre>
<pre class="r"><code>rucc2013 &lt;- rucc2013 %&gt;% 
  mutate(Description = str_extract(Description, &quot;^.*?(?= -)&quot;)) %&gt;% 
  rename(metro_desc = Description)</code></pre>
</div>
<div id="merge-into-single-dataset-at-the-county-level" class="section level2">
<h2>Merge into Single Dataset at the County Level</h2>
<p>In this section, I will join all the datasets I have cleand and processed above into a single dataset containing all the information at the county level rows. The names of the datasets created from the process above are as follows</p>
<ul>
<li><code>ms_broadband_txksme</code></li>
<li><code>godaddy_county_txksme</code></li>
<li><code>mlab_sept_txksme</code>; <code>mlab_oct_txksme</code>; <code>mlab_nov_txksme</code>; <code>mlab_dec_txksme</code></li>
<li><code>tx_proprietor</code></li>
<li><code>rural_2000_txksme</code>; <code>rural_2010_txksme</code></li>
</ul>
<p>I will first inspect the datasets quickly to see if row counts of all datasets are matched since it is possible some of them (especially M-Lab datasets) have less/missing observations. Afterwards, I’ll join the datasets into one.</p>
<pre class="r"><code>#### Inspect the Number of Observations ####
knitr::kable(tibble(MS = count(ms_broadband_txksme)$n, godaddy = count(godaddy_county_txksme)$n,
       mlabsept = count(mlab_sept_txksme)$n, mlaboct = count(mlab_oct_txksme)$n, mlabnov = count(mlab_nov_txksme)$n, mlabdec = count(mlab_dec_txksme)$n,
       txprop = count(tx_proprietor)$n, irr2000 = count(rural_2000_txksme)$n, irr2010 = count(rural_2010_txksme)$n))</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">MS</th>
<th align="right">godaddy</th>
<th align="right">mlabsept</th>
<th align="right">mlaboct</th>
<th align="right">mlabnov</th>
<th align="right">mlabdec</th>
<th align="right">txprop</th>
<th align="right">irr2000</th>
<th align="right">irr2010</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">375</td>
<td align="right">374</td>
<td align="right">367</td>
<td align="right">369</td>
<td align="right">368</td>
<td align="right">370</td>
<td align="right">254</td>
<td align="right">383</td>
<td align="right">383</td>
</tr>
</tbody>
</table>
<p>Several missing observation from M-Lab datasets and one missing from GoDaddy dataset here. Therefore, it is critical that these datasets are not used as a reference dataset for joining. Folloiwng code chunk will use <code>join</code> functions of <code>dplyr</code>.</p>
<pre class="r"><code>#### Join the Datasets ####

str(ms_broadband_txksme)
str(godaddy_county_txksme)
str(mlab_dec_txksme)
str(tx_proprietor)
str(rural_2000_txksme)

## The variables to match from each datasets are
## ms_broadband_tx$COUNTY.ID          Integer
## ms_broadband_tx$COUNTY.NAME        Factor    (&quot;____ County&quot;)
## godaddy_county_tx$cfips            Integer
## godaddy_county_tx$county           Character (&quot;____ County&quot;)
## mlab datasets$county               Character (&quot;____ County&quot;)
## tx_proprietor$county               Character (&quot;____ County&quot;)
## rural datasets#county              Character (&quot;____ County&quot;)

## Create a character vector for ms_broadband_tx dataset to minimize potential error beforehand
ms_broadband_txksme &lt;- ms_broadband_txksme %&gt;% mutate(county = `COUNTY NAME`,
                                                      county_FIPS = as.character(`COUNTY ID`)) %&gt;% 
  select(-c(&quot;COUNTY NAME&quot;,&quot;COUNTY ID&quot;))
str(ms_broadband_txksme)

## Nested left_joins on IRR dataset
names(mlab_sept_txksme) &lt;- paste(names(mlab_sept_txksme), &quot;.sept&quot;, sep = &quot;&quot;)
names(mlab_oct_txksme) &lt;- paste(names(mlab_oct_txksme), &quot;.oct&quot;, sep = &quot;&quot;)
names(mlab_nov_txksme) &lt;- paste(names(mlab_nov_txksme), &quot;.nov&quot;, sep = &quot;&quot;)
names(mlab_dec_txksme) &lt;- paste(names(mlab_dec_txksme), &quot;.dec&quot;, sep = &quot;&quot;)

rural_2010_txksme &lt;- rural_2010_txksme %&gt;% mutate(FIPS2010 = as.character(FIPS2010))
godaddy_county_txksme &lt;- godaddy_county_txksme %&gt;% mutate(cfips = as.character(cfips))

tx_bb_entrepreneur_merged &lt;- left_join(ms_broadband_txksme, rural_2010_txksme, by = c(&quot;county_FIPS&quot; = &quot;FIPS2010&quot;)) %&gt;% 
  left_join(., select(godaddy_county_txksme, c(&quot;cfips&quot;,&quot;county&quot;,&quot;state&quot;,
                                           &quot;venturedensitymay18&quot;,&quot;venturedensitynov18&quot;,
                                           &quot;venturedensityfeb19&quot;,&quot;venturedensitysep19&quot;,
                                           &quot;venturedensityoct19&quot;,&quot;venturedensitynov19&quot;,
                                           &quot;venturedensitydec19&quot;,
                                           &quot;highlyactive_vdmay18&quot;,&quot;highlyactive_vdnov18&quot;,
                                           &quot;highlyactive_vdfeb19&quot;,&quot;highlyactive_vdsep19&quot;,
                                           &quot;highlyactive_vdoct19&quot;,&quot;highlyactive_vdnov19&quot;,
                                           &quot;highlyactive_vddec19&quot;,
                                           &quot;prosperityindex2016&quot;,&quot;prosperity2007&quot;,
                                           &quot;change_prosperity&quot;)), by = c(&quot;county_FIPS&quot; = &quot;cfips&quot;)) %&gt;% 
  left_join(., mlab_sept_txksme, by = c(&quot;county_FIPS&quot; = &quot;county_FIPS.sept&quot;)) %&gt;% 
  left_join(., mlab_oct_txksme, by = c(&quot;county_FIPS&quot; = &quot;county_FIPS.oct&quot;)) %&gt;% 
  left_join(., mlab_nov_txksme, by = c(&quot;county_FIPS&quot; = &quot;county_FIPS.nov&quot;)) %&gt;% 
  left_join(., mlab_dec_txksme, by = c(&quot;county_FIPS&quot; = &quot;county_FIPS.dec&quot;))

str(tx_bb_entrepreneur_merged)

knitr::kable(head(tx_bb_entrepreneur_merged, 20))

## Drop columns with duplicate information

str(tx_bb_entrepreneur_merged)
tx_bb_entrepreneur_merged &lt;- tx_bb_entrepreneur_merged %&gt;%  
  select(-starts_with(&quot;state.&quot;)) %&gt;% 
  select(-starts_with(&quot;county.&quot;)) %&gt;% 
  select(-starts_with(&quot;county_cod&quot;)) %&gt;% 
  select(-starts_with(&quot;state_&quot;))</code></pre>
</div>
<div id="county-business-patterns-nonemployer-statistics-dataset-from-the-census-bureau" class="section level2">
<h2>County Business Patterns &amp; Nonemployer Statistics Dataset from the Census Bureau</h2>
<p>In this section, we will get data from the <a href="https://www.census.gov/data/developers/data-sets/cbp-nonemp-zbp/cbp-api.html">County Business Patterns</a> and the <a href="https://www.census.gov/data/developers/data-sets/cbp-nonemp-zbp/nonemp-api.html">Nonemployer Statistics</a> datasets provided by the Census Bureau. These datasets provide annual statistics of businesses with paid employees and no paid employees or payroll, respectively at a detailed geography and industry level. Using <code>censusapi</code> package, I will interact directly with the Census Bureau API to retrieve and modify data. For those who want to follow, one should <a href="http://api.census.gov/data/key_signup.html">request an API key</a> first before proceeding.</p>
<p>The process here follows a very useful guideline provided by the developer of <code>censusapi</code> package. You can find the introduction with useful information and examples of interacting with various APIs <a href="https://hrecht.github.io/censusapi/articles/getting-started.html">here</a>, and also detailed documentations <a href="https://github.com/hrecht/censusapi">here</a>. If you don’t need to interact with economic or other datasets and only need demographic information available from the American Community Survey estimates, <code>tidycensus</code> <a href="https://walker-data.com/tidycensus/articles/basic-usage.html">from Kyle Walker</a> is also a good alternative. Here, I will mainly show the process using <code>censusapi</code> package.</p>
<p>After installing the package, set up your API key by copying and pasting the code below. Put the API key you got from the Census Bureau instead of what says <code>"YOUR KEY GOES HERE"</code> below.</p>
<pre class="r"><code># For general usage, use install.packages(&quot;censusapi&quot;) to install most stable version of the package.

#devtools::install_github(&quot;jwroycechoi/censusapi&quot;)     # A fork that fixes some issues regarding NAICS2017 and labels
library(censusapi)

# Add key to .Renviron
Sys.setenv(CENSUS_KEY=&quot;YOUR KEY GOES HERE&quot;)
# Reload .Renviron
readRenviron(&quot;~/.Renviron&quot;)
# Check to see that the expected key is output in your R console
Sys.getenv(&quot;CENSUS_KEY&quot;)</code></pre>
<pre><code>## 
## Attaching package: &#39;censusapi&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:methods&#39;:
## 
##     getFunction</code></pre>
<p>You can take a look at available APIs and other important metadata related to specific APIs using the following functions. Refer to specific documentations of the functions as well as the specific API that you want to investigate.</p>
<ul>
<li><code>listCensusApis()</code>: Retrieve all available API handles provided by the Census Bureau.</li>
<li><code>listCensusMetadata()</code>: Retrieve important metadata of specific APIs in specific years, such as the variables or geography.</li>
</ul>
<p>We are interested in County Business Patterns and Nonemployers Statistics. We can check the variables available from the datasets and the geogrphic level using the code below.</p>
<pre class="r"><code>#### CBP Dataset ####
## County Business Pattern dataset variables and geography
View(listCensusMetadata(name = &quot;cbp&quot;, vintage = 2012, type = &quot;variables&quot;))
View(listCensusMetadata(name = &quot;cbp&quot;, vintage = 2017, type = &quot;variables&quot;))
View(listCensusMetadata(name = &quot;cbp&quot;, vintage = 2018, type = &quot;variables&quot;))
listCensusMetadata(name = &quot;cbp&quot;, vintage = 2017, type = &quot;geography&quot;)
listCensusMetadata(name = &quot;cbp&quot;, vintage = 2018, type = &quot;geography&quot;)

# You can also put the variable names into separate object if you want to use it for further queries
cbp2017_var &lt;- listCensusMetadata(name = &quot;cbp&quot;, vintage = 2017, type = &quot;variables&quot;)$name

#### Nonemployer Dataset ####
View(listCensusMetadata(name = &quot;nonemp&quot;, vintage = 2012, type = &quot;variables&quot;))
View(listCensusMetadata(name = &quot;nonemp&quot;, vintage = 2017, type = &quot;variables&quot;))
View(listCensusMetadata(name = &quot;nonemp&quot;, vintage = 2018, type = &quot;variables&quot;))
listCensusMetadata(name = &quot;nonemp&quot;, vintage = 2017, type = &quot;geography&quot;)
listCensusMetadata(name = &quot;nonemp&quot;, vintage = 2018, type = &quot;geography&quot;)</code></pre>
<p>In order to retrive the datasets from the Census database you use <code>getCensus</code> function with specific arguments. Generally, required arguments are <code>name</code>, <code>vintage</code>(i.e., year), <code>vars</code>(i.e., variables), and <code>region</code>. In the code below, I’ll retrieve CBP and Nonemployer datasets from year 2017 and 2018 for all counties within three states of our interest.</p>
<pre class="r"><code>## Retrieve CBP datasets for the three states in 2017 and 2018 ##
cbp2012_txksme &lt;- getCensus(name = &quot;cbp&quot;,
                            vintage = 2012,
                            vars = c(&quot;EMP&quot;,&quot;EMP_F&quot;,&quot;EMPSZES&quot;,&quot;EMPSZES_TTL&quot;,&quot;ESTAB&quot;,&quot;ESTAB_F&quot;),
                            region = &quot;county:*&quot;,
                            regionin = &quot;state:20,23,48&quot;)

cbp2017_txksme &lt;- getCensus(name = &quot;cbp&quot;,
                            vintage = 2017,
                            vars = c(&quot;EMP&quot;,&quot;EMP_F&quot;,&quot;EMPSZES&quot;,&quot;EMPSZES_LABEL&quot;,&quot;ESTAB&quot;,&quot;ESTAB_F&quot;),
                            region = &quot;county:*&quot;,
                            regionin = &quot;state:20,23,48&quot;)

cbp2018_txksme &lt;- getCensus(name = &quot;cbp&quot;,
                            vintage = 2018,
                            vars = c(&quot;EMP&quot;,&quot;EMP_F&quot;,&quot;EMPSZES&quot;,&quot;EMPSZES_LABEL&quot;,&quot;ESTAB&quot;,&quot;ESTAB_F&quot;),
                            region = &quot;county:*&quot;,
                            regionin = &quot;state:20,23,48&quot;)

## Retrieve Nonemployer datasets for the three states in 2017 and 2018 ##
nonemp2012 &lt;- getCensus(name = &quot;nonemp&quot;,
                        vintage = 2012,
                        vars = c(&quot;NESTAB&quot;,&quot;NESTAB_F&quot;,&quot;NAICS2012&quot;,&quot;NAICS2012_TTL&quot;,&quot;SECTOR&quot;),
                        region = &quot;county:*&quot;,
                        regionin = &quot;state:20,23,48&quot;)

nonemp2017 &lt;- getCensus(name = &quot;nonemp&quot;,
                        vintage = 2017,
                        vars = c(&quot;NESTAB&quot;,&quot;NESTAB_F&quot;,&quot;NAICS2017&quot;,&quot;NAICS2017_TTL&quot;,&quot;SECTOR&quot;),
                        region = &quot;county:*&quot;,
                        regionin = &quot;state:20,23,48&quot;)

nonemp2018 &lt;- getCensus(name = &quot;nonemp&quot;,
                        vintage = 2018,
                        vars = c(&quot;NESTAB&quot;,&quot;NESTAB_F&quot;,&quot;NAICS2017&quot;,&quot;NAICS2017_LABEL&quot;,&quot;SECTOR&quot;),
                        region = &quot;county:*&quot;,
                        regionin = &quot;state:20,23,48&quot;)</code></pre>
<p>Some variables should be numerical instead of character. Also, I’ll create few factors for easier interpretation of regional information. Here I will create variables that could potentially represent entrepreneurial activities within the counties. The variables have to be aggregated into county level observations. Note that currently our research purpose does not weigh into investigating industry breakdowns or revenues. Following list of variables will be aggregated at the county level:</p>
<p><strong>County Business Patterns Dataset</strong></p>
<ul>
<li><code>emp_cbp_YEAR</code>: Total employment for all industry sectors and all establishments in the county</li>
<li><code>pct_50_est_cbp_YEAR</code>: % of establishments with less than 50 employees over all establishments in the county</li>
<li><code>pct_10_est_cbp_YEAR</code>: % of establishments with less than 10 employees over all establishments in the county</li>
</ul>
<p><strong>Nonemployer Statistics</strong></p>
<ul>
<li><code>neest_nemp_YEAR</code>: Total nonemployer establishments for all industry sectors in the county</li>
<li><code>nonfarmneest_nemp_YEAR</code>: Total nonfarm nonemployer establishments in the county</li>
<li><code>pct_nonfarmneest_nemp_YEAR</code>: % of nonfarm nonemployer establishments over all nonemployer establishments in the county</li>
</ul>
<pre class="r"><code>## Some modifications for CBP datasets ##
cbp2012_txksme &lt;- cbp2012_txksme %&gt;% 
  mutate(county_FIPS = paste(state, county, sep = &quot;&quot;),
         EMP = as.numeric(EMP),
         ESTAB = as.numeric(ESTAB),
         EMP = case_when(EMP_F == &quot;a&quot; ~ round(median(seq(0,19)), digits = 0),  # For employment range symbols, replace with median of the range
                         EMP_F == &quot;b&quot; ~ round(median(seq(20,99)), digits = 0),
                         EMP_F == &quot;c&quot; ~ round(median(seq(100,249)), digits = 0),
                         EMP_F == &quot;e&quot; ~ round(median(seq(250,499)), digits = 0),
                         EMP_F == &quot;f&quot; ~ round(median(seq(500,999)), digits = 0),
                         EMP_F == &quot;g&quot; ~ round(median(seq(1000,2499)), digits = 0),
                         EMP_F == &quot;h&quot; ~ round(median(seq(2500,4999)), digits = 0),
                         EMP_F == &quot;i&quot; ~ round(median(seq(5000,9999)), digits = 0),
                         EMP_F == &quot;j&quot; ~ round(median(seq(10000,24999)), digits = 0),
                         EMP_F == &quot;k&quot; ~ round(median(seq(25000,49999)), digits = 0),
                         EMP_F == &quot;l&quot; ~ round(median(seq(50000,99999)), digits = 0),
                         EMP_F == &quot;m&quot; ~ 100000,
                         TRUE ~ EMP))

cbp2017_txksme &lt;- cbp2017_txksme %&gt;% 
  mutate(county_FIPS = paste(state, county, sep = &quot;&quot;),
         EMP = as.numeric(EMP),
         ESTAB = as.numeric(ESTAB),
         EMP = case_when(EMP_F == &quot;a&quot; ~ round(median(seq(0,19)), digits = 0),  # For employment range symbols, replace with median of the range
                         EMP_F == &quot;b&quot; ~ round(median(seq(20,99)), digits = 0),
                         EMP_F == &quot;c&quot; ~ round(median(seq(100,249)), digits = 0),
                         EMP_F == &quot;e&quot; ~ round(median(seq(250,499)), digits = 0),
                         EMP_F == &quot;f&quot; ~ round(median(seq(500,999)), digits = 0),
                         EMP_F == &quot;g&quot; ~ round(median(seq(1000,2499)), digits = 0),
                         EMP_F == &quot;h&quot; ~ round(median(seq(2500,4999)), digits = 0),
                         EMP_F == &quot;i&quot; ~ round(median(seq(5000,9999)), digits = 0),
                         EMP_F == &quot;j&quot; ~ round(median(seq(10000,24999)), digits = 0),
                         EMP_F == &quot;k&quot; ~ round(median(seq(25000,49999)), digits = 0),
                         EMP_F == &quot;l&quot; ~ round(median(seq(50000,99999)), digits = 0),
                         EMP_F == &quot;m&quot; ~ 100000,
                         TRUE ~ EMP))

cbp2018_txksme &lt;- cbp2018_txksme %&gt;% 
  mutate(county_FIPS = paste(state, county, sep = &quot;&quot;),
         EMP = as.numeric(EMP),
         ESTAB = as.numeric(ESTAB),
         EMP = case_when(EMP_F == &quot;a&quot; ~ round(median(seq(0,19)), digits = 0),  # For employment range symbols, replace with median of the range
                         EMP_F == &quot;b&quot; ~ round(median(seq(20,99)), digits = 0),
                         EMP_F == &quot;c&quot; ~ round(median(seq(100,249)), digits = 0),
                         EMP_F == &quot;e&quot; ~ round(median(seq(250,499)), digits = 0),
                         EMP_F == &quot;f&quot; ~ round(median(seq(500,999)), digits = 0),
                         EMP_F == &quot;g&quot; ~ round(median(seq(1000,2499)), digits = 0),
                         EMP_F == &quot;h&quot; ~ round(median(seq(2500,4999)), digits = 0),
                         EMP_F == &quot;i&quot; ~ round(median(seq(5000,9999)), digits = 0),
                         EMP_F == &quot;j&quot; ~ round(median(seq(10000,24999)), digits = 0),
                         EMP_F == &quot;k&quot; ~ round(median(seq(25000,49999)), digits = 0),
                         EMP_F == &quot;l&quot; ~ round(median(seq(50000,99999)), digits = 0),
                         EMP_F == &quot;m&quot; ~ 100000,
                         TRUE ~ EMP))

# Also, we need to filter for state of Texas at this point of the analysis
cbp2012_tx &lt;- cbp2012_txksme %&gt;% filter(state == &quot;48&quot;)
cbp2017_tx &lt;- cbp2017_txksme %&gt;% filter(state == &quot;48&quot;)
cbp2018_tx &lt;- cbp2018_txksme %&gt;% filter(state == &quot;48&quot;)

## Some modifications for Nonemployer datasets ##
nonemp2012 &lt;- nonemp2012 %&gt;% 
  mutate(county_FIPS = paste(state, county, sep = &quot;&quot;),
         NESTAB = as.numeric(NESTAB))

nonemp2017 &lt;- nonemp2017 %&gt;% 
  mutate(county_FIPS = paste(state, county, sep = &quot;&quot;),
         NESTAB = as.numeric(NESTAB))

nonemp2018 &lt;- nonemp2018 %&gt;% 
  mutate(county_FIPS = paste(state, county, sep = &quot;&quot;),
         NESTAB = as.numeric(NESTAB))

# Filter Texas
nonemp2012_tx &lt;- nonemp2012 %&gt;% filter(state == &quot;48&quot;)
nonemp2017_tx &lt;- nonemp2017 %&gt;% filter(state == &quot;48&quot;)
nonemp2018_tx &lt;- nonemp2018 %&gt;% filter(state == &quot;48&quot;)</code></pre>
<pre class="r"><code>#### CBP Dataset Aggregation ####
cbp2012_txksme_agg &lt;- cbp2012_txksme %&gt;% 
  filter(EMPSZES == &quot;001&quot;|EMPSZES == &quot;210&quot;|EMPSZES == &quot;212&quot;|EMPSZES == &quot;220&quot;|EMPSZES == &quot;230&quot;|EMPSZES == &quot;241&quot;) %&gt;% # Filter for employment size
  mutate(est_total = ifelse(EMPSZES == &quot;001&quot;, ESTAB, 0),
         emp_total = ifelse(EMPSZES == &quot;001&quot;, EMP, 0),
         est_50 = ifelse(EMPSZES != &quot;001&quot;, ESTAB, 0),
         est_10 = ifelse(EMPSZES == &quot;212&quot; | EMPSZES == &quot;220&quot;, ESTAB, 0)) %&gt;% 
  group_by(county_FIPS) %&gt;% 
  summarise(emp_cbp_2012 = sum(emp_total, na.rm = T),
            est_cbp_2012 = sum(est_total, na.rm = T),
            est_50_cbp_2012 = sum(est_50, na.rm = T),
            est_10_cbp_2012 = sum(est_10, na.rm = T)) %&gt;% 
  mutate(pct_50_est_cbp_2012 = est_50_cbp_2012 / est_cbp_2012,
         pct_10_est_cbp_2012 = est_10_cbp_2012 / est_cbp_2012)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>cbp2017_txksme_agg &lt;- cbp2017_txksme %&gt;% 
  filter(EMPSZES == &quot;001&quot;|EMPSZES == &quot;210&quot;|EMPSZES == &quot;212&quot;|EMPSZES == &quot;220&quot;|EMPSZES == &quot;230&quot;|EMPSZES == &quot;241&quot;) %&gt;% # Filter for employment size
  mutate(est_total = ifelse(EMPSZES == &quot;001&quot;, ESTAB, 0),
         emp_total = ifelse(EMPSZES == &quot;001&quot;, EMP, 0),
         est_50 = ifelse(EMPSZES != &quot;001&quot;, ESTAB, 0),
         est_10 = ifelse(EMPSZES == &quot;210&quot; | EMPSZES == &quot;220&quot;, ESTAB, 0)) %&gt;% 
  group_by(county_FIPS) %&gt;% 
  summarise(emp_cbp_2017 = sum(emp_total, na.rm = T),
            est_cbp_2017 = sum(est_total, na.rm = T),
            est_50_cbp_2017 = sum(est_50, na.rm = T),
            est_10_cbp_2017 = sum(est_10, na.rm = T)) %&gt;% 
  mutate(pct_50_est_cbp_2017 = est_50_cbp_2017 / est_cbp_2017,
         pct_10_est_cbp_2017 = est_10_cbp_2017 / est_cbp_2017)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>cbp2018_txksme_agg &lt;- cbp2018_txksme %&gt;% 
  filter(EMPSZES == &quot;001&quot;|EMPSZES == &quot;210&quot;|EMPSZES == &quot;212&quot;|EMPSZES == &quot;220&quot;|EMPSZES == &quot;230&quot;|EMPSZES == &quot;241&quot;) %&gt;% # Filter for employment size
  mutate(est_total = ifelse(EMPSZES == &quot;001&quot;, ESTAB, 0),
         emp_total = ifelse(EMPSZES == &quot;001&quot;, EMP, 0),
         est_50 = ifelse(EMPSZES != &quot;001&quot;, ESTAB, 0),
         est_10 = ifelse(EMPSZES == &quot;210&quot; | EMPSZES == &quot;220&quot;, ESTAB, 0)) %&gt;% 
  group_by(county_FIPS) %&gt;% 
  summarise(emp_cbp_2018 = sum(emp_total, na.rm = T),
            est_cbp_2018 = sum(est_total, na.rm = T),
            est_50_cbp_2018 = sum(est_50, na.rm = T),
            est_10_cbp_2018 = sum(est_10, na.rm = T)) %&gt;% 
  mutate(pct_50_est_cbp_2018 = est_50_cbp_2018 / est_cbp_2018,
         pct_10_est_cbp_2018 = est_10_cbp_2018 / est_cbp_2018)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>## Merge three years datasets ##
cbp_txksme &lt;- left_join(cbp2012_txksme_agg, cbp2017_txksme_agg, by = &quot;county_FIPS&quot;) %&gt;% left_join(., cbp2018_txksme_agg, by = &quot;county_FIPS&quot;)

#### Nonemployer Dataset Aggregation ####
nonemp2012_txksme_agg &lt;- nonemp2012 %&gt;% 
  mutate(est_total = ifelse(NAICS2012 == &quot;00&quot;, NESTAB, 0),
         nonfarm_est_total = ifelse(str_detect(NAICS2012, &quot;^11&quot;, negate = TRUE), NESTAB, 0),
         nonfarm_est_total = ifelse(NAICS2012 == &quot;00&quot;, 0, nonfarm_est_total)) %&gt;% 
  group_by(SECTOR, county_FIPS) %&gt;% slice(1) %&gt;% ungroup() %&gt;% 
  group_by(county_FIPS) %&gt;% 
  summarise(neest_nemp_2012 = sum(est_total, na.rm = T),
            nonfarmneest_nemp_2012 = sum(nonfarm_est_total, na.rm = T)) %&gt;% 
  mutate(pct_nonfarmneest_nemp_2012 = nonfarmneest_nemp_2012 / neest_nemp_2012)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>nonemp2017_txksme_agg &lt;- nonemp2017 %&gt;% 
  mutate(est_total = ifelse(SECTOR == &quot;00&quot;, NESTAB, 0),
         nonfarm_est_total = ifelse(str_detect(NAICS2017, &quot;^11&quot;, negate = TRUE), NESTAB, 0),
         nonfarm_est_total = ifelse(NAICS2017 == &quot;00&quot;, 0, nonfarm_est_total)) %&gt;% 
  group_by(SECTOR, county_FIPS) %&gt;% slice(1) %&gt;% ungroup() %&gt;% 
  group_by(county_FIPS) %&gt;% 
  summarise(neest_nemp_2017 = sum(est_total, na.rm = T),
            nonfarmneest_nemp_2017 = sum(nonfarm_est_total, na.rm = T)) %&gt;% 
  mutate(pct_nonfarmneest_nemp_2017 = nonfarmneest_nemp_2017 / neest_nemp_2017)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>nonemp2018_txksme_agg &lt;- nonemp2018 %&gt;% 
  mutate(est_total = ifelse(SECTOR == &quot;00&quot;, NESTAB, 0),
         nonfarm_est_total = ifelse(str_detect(NAICS2017, &quot;^11&quot;, negate = TRUE), NESTAB, 0),
         nonfarm_est_total = ifelse(NAICS2017 == &quot;00&quot;, 0, nonfarm_est_total)) %&gt;% 
  group_by(SECTOR, county_FIPS) %&gt;% slice(1) %&gt;% ungroup() %&gt;% 
  group_by(county_FIPS) %&gt;% 
  summarise(neest_nemp_2018 = sum(est_total, na.rm = T),
            nonfarmneest_nemp_2018 = sum(nonfarm_est_total, na.rm = T)) %&gt;% 
  mutate(pct_nonfarmneest_nemp_2018 = nonfarmneest_nemp_2018 / neest_nemp_2018)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>## Merge three years datasets ##
nonemp_txksme &lt;- left_join(nonemp2012_txksme_agg, nonemp2017_txksme_agg, by= &quot;county_FIPS&quot;) %&gt;% left_join(., nonemp2018_txksme_agg, by = &quot;county_FIPS&quot;) %&gt;% 
  mutate(chg_pct_nonfarmneest_nemp_2012_2018 = pct_nonfarmneest_nemp_2018 - pct_nonfarmneest_nemp_2012)</code></pre>
</div>
<div id="other-economic-statistics" class="section level2">
<h2>Other Economic Statistics</h2>
<p>Additionally, I will gather several other economic statistics from few other datasets. THe information gathered here will be <strong>employments, nonfarm proprietors, number of firms, and change in number of firms</strong>. Information regarding the employments and nonfarm proprietors will be gathered from dataset provided by the <a href="https://www.bea.gov">Bureau of Economic Analysis (BEA)</a>. Previous data from CBP and Nonemployer Statistics (NS) provide information at the level of establishments. Datasets from the <a href="https://www.census.gov/programs-surveys/abs.html">Annual Business Survey (ABS)</a> provides <em>firm level</em> statistics. The Annual Business Survey is a survey conducted by the Census Bureau that replaces five-year Survey of Business Owners (SBO) for employer businesses, the Annual Survey of Entrepreneurs (ASE), the Business R&amp;D and Innovation for Microbusinesses survey (BRDI-M), and the innovation section of the Business R&amp;D and Innovation Survey (BRDI-S) from survey year 2017. Comparable information from previous time frame will be imported from SBO and ASE datasets.</p>
<p>From the aforementioned datasets, I will retrieve and create the following measures:</p>
<p><strong>Bureau of Economic Analysis (BEA)</strong></p>
<ul>
<li><code>pct_nonfarm_propr_YEAR</code>: % of nonfarm proprietors over total employment</li>
<li><code>pct_chg_bea_2012_2018</code>: Change in % of nonfarm proprietors over total employment between 2012 and 2018</li>
</ul>
<p><strong>Annual Business Survey (ABS) (+ SBO, ASE)</strong></p>
<ul>
<li><code>firm_YEAR</code>: Number of firms with paid employees</li>
<li><code>chg_firm_YEAR</code>: Change in the number of firms with paid employees</li>
</ul>
<div id="bea-dataset-api-call" class="section level3">
<h3>BEA Dataset API Call</h3>
<p>For BEA data, you have to separately <a href="https://apps.bea.gov/API/signup/index.cfm">register for BEA API key</a>. In <code>R</code>, there is a package that helps you interact with BEA API called <code>bea.R</code>. Detailed information and instructions can be found <a href="https://github.com/us-bea/bea.R">here</a>.</p>
<pre class="r"><code>#### BEA API Interaction and Dataset Explore ####
## Use bea.R package. An introduction of how the package works is available in the GitHub page (https://github.com/us-bea/bea.R) ##
## Mainly we want to explore what kind of data is available and will be useful in terms of entrepreneurship.
## Specifically non-farm proprietorship information that is comparable across different states.

install.packages(&quot;bea.R&quot;)

library(bea.R)
library(tidyverse)

# Set up the API Key
beaKey &lt;- &quot;YOUR API KEY&quot;

#### Checking datasets and available tables etc. ####
## BEA API exploration requires few prior knowledge on available datasets and tables
## Datasets available are listed here (https://apps.bea.gov/API/signup/index.cfm)
## Tables and parameters used for querying specific datasets are available in the appendices in the API user guide (https://apps.bea.gov/API/bea_web_service_api_user_guide.htm#tabs-9a)
## Another way to identify what you are looking for is playing around with interactive application provided by BEA here (https://apps.bea.gov/itable/itable.cfm).
## In our case we want to look at county level regional information. Specifically, nonfarm proprietors employment

### First, you can use beaSearch to see what data tables are available by keyword

beaSearch(&quot;Regional&quot;, beaKey, asHtml = T)     # Currently, regional dataset is depracated and seems like the bea.R package hasn&#39;t yet been fully updated

### Second, inspect the parameters and parameter values
## We can look at what parameters are available for querying the dataset &#39;Regional&#39; by using code below
beaParams(beaKey = beaKey, &#39;Regional&#39;)
## Further, you can see what values are available for specific parameter using code below
beaParamVals(beaKey = beaKey, &#39;Regional&#39;, &#39;TableName&#39;)
beaParamVals(beaKey = beaKey, &#39;Regional&#39;, &#39;LineCode&#39;)</code></pre>
<pre class="r"><code>library(bea.R)</code></pre>
<pre><code>## Loading required package: data.table</code></pre>
<pre><code>## 
## Attaching package: &#39;data.table&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     between, first, last</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     transpose</code></pre>
<pre><code>## Creating a generic function for &#39;toJSON&#39; from package &#39;jsonlite&#39; in package &#39;googleVis&#39;</code></pre>
<pre><code>## Note: As of February 2018, beaGet() requires &#39;TableName&#39; for NIPA and NIUnderlyingDetail data instead of &#39;TableID.&#39; See https://github.us-bea/bea.R for details.</code></pre>
<pre class="r"><code>### Finally, we will use the parameter and parameter values to retrieve data table
## In terms of LineCode, we are interested in:
## 10: Total employment
## 20: Wage and salary employment
## 40: Proprietors employment
## 60: Nonfarm proprietors employment

## In terms of GeoFips, we will query all counties and then filter later on for the three states: Kansas, Maine, Texas
## In terms of Year, the research team has decided to look at the most recent year (2018) and 2012 as it is the year the nation started
## to recover from the Recession

## The LineCode parameter does not allow multiple values input.
## Therefore, we have to generate separate tables for each LineCode and merge afterwards

#### Retrive Data tables from BEA API ####
# LineCode 10
beaSpecs_10 &lt;- list(
  &#39;UserID&#39; = beaKey,
  &#39;Method&#39; = &#39;GetData&#39;,
  &#39;datasetname&#39; = &#39;Regional&#39;,
  &#39;TableName&#39; = &#39;CAEMP25N&#39;,
  &#39;LineCode&#39; = 10,
  &#39;GeoFips&#39; = &#39;COUNTY&#39;,
  &#39;Year&#39; = &#39;2012,2018&#39;
)

bea_10 &lt;- beaGet(beaSpecs_10, asWide = TRUE)

# LineCode 20
beaSpecs_20 &lt;- list(
  &#39;UserID&#39; = beaKey,
  &#39;Method&#39; = &#39;GetData&#39;,
  &#39;datasetname&#39; = &#39;Regional&#39;,
  &#39;TableName&#39; = &#39;CAEMP25N&#39;,
  &#39;LineCode&#39; = 20,
  &#39;GeoFips&#39; = &#39;COUNTY&#39;,
  &#39;Year&#39; = &#39;2012,2018&#39;
)

bea_20 &lt;- beaGet(beaSpecs_20, asWide = TRUE)

# LineCode 40
beaSpecs_40 &lt;- list(
  &#39;UserID&#39; = beaKey,
  &#39;Method&#39; = &#39;GetData&#39;,
  &#39;datasetname&#39; = &#39;Regional&#39;,
  &#39;TableName&#39; = &#39;CAEMP25N&#39;,
  &#39;LineCode&#39; = 40,
  &#39;GeoFips&#39; = &#39;COUNTY&#39;,
  &#39;Year&#39; = &#39;2012,2018&#39;
)

bea_40 &lt;- beaGet(beaSpecs_40, asWide = TRUE)

# LineCode 60
beaSpecs_60 &lt;- list(
  &#39;UserID&#39; = beaKey,
  &#39;Method&#39; = &#39;GetData&#39;,
  &#39;datasetname&#39; = &#39;Regional&#39;,
  &#39;TableName&#39; = &#39;CAEMP25N&#39;,
  &#39;LineCode&#39; = 60,
  &#39;GeoFips&#39; = &#39;COUNTY&#39;,
  &#39;Year&#39; = &#39;2012,2018&#39;
)

bea_60 &lt;- beaGet(beaSpecs_60, asWide = TRUE)

#### Clean, Filter the Data Tables and Merge ####
## BEA Total Employment
bea_10 &lt;- bea_10 %&gt;% filter(str_detect(GeoFips, &quot;^48&quot;)|str_detect(GeoFips, &quot;^20&quot;)|str_detect(GeoFips, &quot;^23&quot;)) %&gt;% 
  select(GeoFips, DataValue_2012, DataValue_2018) %&gt;% 
  rename(totalemp_bea_2012 = DataValue_2012,
         totalemp_bea_2018 = DataValue_2018)
## BEA Wage and Salary Employment
bea_20 &lt;- bea_20 %&gt;% filter(str_detect(GeoFips, &quot;^48&quot;)|str_detect(GeoFips, &quot;^20&quot;)|str_detect(GeoFips, &quot;^23&quot;)) %&gt;% 
  select(GeoFips, DataValue_2012, DataValue_2018) %&gt;% 
  rename(salaryemp_bea_2012 = DataValue_2012,
         salaryemp_bea_2018 = DataValue_2018)
## BEA Proprietors Employment
bea_40 &lt;- bea_40 %&gt;% filter(str_detect(GeoFips, &quot;^48&quot;)|str_detect(GeoFips, &quot;^20&quot;)|str_detect(GeoFips, &quot;^23&quot;)) %&gt;% 
  select(GeoFips, DataValue_2012, DataValue_2018) %&gt;% 
  rename(proprietors_bea_2012 = DataValue_2012,
         proprietors_bea_2018 = DataValue_2018)
## BEA Nonfarm Proprietors Employment
bea_60 &lt;- bea_60 %&gt;% filter(str_detect(GeoFips, &quot;^48&quot;)|str_detect(GeoFips, &quot;^20&quot;)|str_detect(GeoFips, &quot;^23&quot;)) %&gt;% 
  select(GeoFips, DataValue_2012, DataValue_2018) %&gt;% 
  rename(nonfarmproprietors_bea_2012 = DataValue_2012,
         nonfarmproprietors_bea_2018 = DataValue_2018)

## Merge Datasets ##
bea_nonfarmproprietor_txksme &lt;- left_join(bea_10, bea_20, by = &quot;GeoFips&quot;) %&gt;% 
  left_join(., bea_40, by = &quot;GeoFips&quot;) %&gt;% left_join(., bea_60, by = &quot;GeoFips&quot;)

## Calculate Several Variables ##
# Percentage variables and change
# Percentage of nonfarm proprietors in total employment
# Percentage change from 2012 to 2018

bea_nonfarmproprietor_txksme &lt;- bea_nonfarmproprietor_txksme %&gt;% 
  mutate(pct_nonfarm_bea_2012 = nonfarmproprietors_bea_2012 / totalemp_bea_2012,
         pct_nonfarm_bea_2018 = nonfarmproprietors_bea_2018 / totalemp_bea_2018,
         pct_chg_bea_2012_2018 = pct_nonfarm_bea_2018 - pct_nonfarm_bea_2012)


# Finally filter for Texas state
bea_nonfarmproprietor_tx &lt;- bea_nonfarmproprietor_txksme %&gt;% 
  filter(str_detect(GeoFips, &quot;^48&quot;))</code></pre>
</div>
<div id="abs-dataset-api-call" class="section level3">
<h3>ABS Dataset API Call</h3>
<p>In this section, I will import relevant datasets from ABS, ASE, and SBO and create a dataset that will be used for final merge.</p>
<pre class="r"><code>#### Look at ABS Metadata ####
## Detailed information about available tables and variables can be found in PDF documents here (https://www.census.gov/programs-surveys/abs/technical-documentation/api.html)

View(listCensusMetadata(name = &quot;abscs&quot;, vintage = 2017, type = &quot;variables&quot;))
View(listCensusMetadata(name = &quot;ase/csa&quot;, vintage = 2015, type = &quot;variables&quot;))
View(listCensusMetadata(name = &quot;ase/csa&quot;, vintage = 2015, type = &quot;geographies&quot;))  # Can&#39;t use ASE data because it does not have county level info
View(listCensusMetadata(name = &quot;sbo&quot;, vintage = 2012, type = &quot;variables&quot;))
View(listCensusMetadata(name = &quot;sbo&quot;, vintage = 2012, type = &quot;geographies&quot;))</code></pre>
<pre class="r"><code>## ABS Company Summary Datatable ##
firmlevel_2017 &lt;- getCensus(name = &quot;abscs&quot;,
                        vintage = 2017,
                        vars = c(&quot;EMP&quot;,&quot;EMP_F&quot;,&quot;FIRMPDEMP&quot;,&quot;FIRMPDEMP_F&quot;),
                        region = &quot;county:*&quot;,
                        regionin = &quot;state:20,23,48&quot;)

firmlevel_2012 &lt;- getCensus(name = &quot;sbo&quot;,
                            vintage = 2012,
                            vars = c(&quot;EMP&quot;,&quot;EMP_F&quot;,&quot;FIRMPDEMP&quot;,&quot;FIRMPDEMP_F&quot;),
                            region = &quot;county:*&quot;,
                            regionin = &quot;state:20,23,48&quot;)

## Clean and transform ##
firmlevel_2012 &lt;- firmlevel_2012 %&gt;% 
  mutate(county_FIPS = paste(state, county, sep = &quot;&quot;),
         EMP = as.numeric(EMP),
         FIRMPDEMP = as.numeric(FIRMPDEMP),
         EMP = case_when(EMP_F == &quot;a&quot; ~ round(median(seq(0,19)), digits = 0),  # For employment range symbols, replace with median of the range
                         EMP_F == &quot;b&quot; ~ round(median(seq(20,99)), digits = 0),
                         EMP_F == &quot;c&quot; ~ round(median(seq(100,249)), digits = 0),
                         EMP_F == &quot;e&quot; ~ round(median(seq(250,499)), digits = 0),
                         EMP_F == &quot;f&quot; ~ round(median(seq(500,999)), digits = 0),
                         EMP_F == &quot;g&quot; ~ round(median(seq(1000,2499)), digits = 0),
                         EMP_F == &quot;h&quot; ~ round(median(seq(2500,4999)), digits = 0),
                         EMP_F == &quot;i&quot; ~ round(median(seq(5000,9999)), digits = 0),
                         EMP_F == &quot;j&quot; ~ round(median(seq(10000,24999)), digits = 0),
                         EMP_F == &quot;k&quot; ~ round(median(seq(25000,49999)), digits = 0),
                         EMP_F == &quot;l&quot; ~ round(median(seq(50000,99999)), digits = 0),
                         EMP_F == &quot;m&quot; ~ 100000,
                         TRUE ~ EMP),
         FIRMPDEMP = case_when(FIRMPDEMP_F == &quot;S&quot; ~ NA_real_, TRUE ~ FIRMPDEMP)) %&gt;% 
  rename(emp_abs_2012 = EMP, firm_2012 = FIRMPDEMP) %&gt;% 
  select(-c(&quot;EMP_F&quot;,&quot;FIRMPDEMP_F&quot;,&quot;state&quot;,&quot;county&quot;))

firmlevel_2017 &lt;- firmlevel_2017 %&gt;% 
  mutate(county_FIPS = paste(state, county, sep = &quot;&quot;),
         EMP = as.numeric(EMP),
         FIRMPDEMP = as.numeric(FIRMPDEMP),
         EMP = case_when(EMP_F == &quot;a&quot; ~ round(median(seq(0,19)), digits = 0),  # For employment range symbols, replace with median of the range
                         EMP_F == &quot;b&quot; ~ round(median(seq(20,99)), digits = 0),
                         EMP_F == &quot;c&quot; ~ round(median(seq(100,249)), digits = 0),
                         EMP_F == &quot;e&quot; ~ round(median(seq(250,499)), digits = 0),
                         EMP_F == &quot;f&quot; ~ round(median(seq(500,999)), digits = 0),
                         EMP_F == &quot;g&quot; ~ round(median(seq(1000,2499)), digits = 0),
                         EMP_F == &quot;h&quot; ~ round(median(seq(2500,4999)), digits = 0),
                         EMP_F == &quot;i&quot; ~ round(median(seq(5000,9999)), digits = 0),
                         EMP_F == &quot;j&quot; ~ round(median(seq(10000,24999)), digits = 0),
                         EMP_F == &quot;k&quot; ~ round(median(seq(25000,49999)), digits = 0),
                         EMP_F == &quot;l&quot; ~ round(median(seq(50000,99999)), digits = 0),
                         EMP_F == &quot;m&quot; ~ 100000,
                         TRUE ~ EMP),
         FIRMPDEMP = case_when(FIRMPDEMP_F == &quot;S&quot; ~ NA_real_, TRUE ~ FIRMPDEMP)) %&gt;% 
  rename(emp_abs_2017 = EMP, firm_2017 = FIRMPDEMP) %&gt;% 
  select(-c(&quot;EMP_F&quot;,&quot;FIRMPDEMP_F&quot;,&quot;state&quot;,&quot;county&quot;))

## Join the two years, filter Texas, and calculate change variable ##
firmlevel_txksme &lt;- left_join(firmlevel_2012, firmlevel_2017, by = &quot;county_FIPS&quot;) %&gt;% filter(str_detect(county_FIPS, &quot;^48&quot;)|str_detect(county_FIPS, &quot;^20&quot;)|str_detect(county_FIPS, &quot;^23&quot;)) %&gt;% 
  mutate(chg_firm_2012_2017 = firm_2017 - firm_2012)</code></pre>
</div>
</div>
<div id="acs-broadband-measures-and-demographics" class="section level2">
<h2>ACS Broadband Measures and Demographics</h2>
<p>The ACS broadband subscription measures currently available from the dataset provided by the Arizona State University research team represents people with <strong>“any”</strong> type of broadband <em>including cell phone subscription</em>. This not only could potentially inflate the subscription number, but also does not allow much comparability with other broadband variables. Therefore, I will <strong>call the ACS data directly to retrieve fixed broadband subscription</strong> excluding wireless options such as satellite and cell phone broadband.</p>
<p>Furthermore, I will update the demographic information using direct and most up-to-date data from the API.</p>
<pre class="r"><code>#### ACS Broadband Subscription Dataset ####
View(listCensusMetadata(name = &quot;acs/acs5&quot;, vintage = 2018, type = &quot;variables&quot;))
View(listCensusMetadata(name = &quot;acs/acs5/profile&quot;, vintage = 2018, type = &quot;variables&quot;))
View(listCensusMetadata(name = &quot;pep/charagegroups&quot;, vintage = 2019, type = &quot;variables&quot;))
View(listCensusMetadata(name = &quot;acs/acs5/subject&quot;, vintage = 2018, type = &quot;variables&quot;))
View(listCensusMetadata(name = &quot;acs/acs5/subject&quot;, vintage = 2018, type = &quot;geography&quot;))</code></pre>
<pre class="r"><code>## Broadband Subscription Percentage from Subject Table ##
acs_broadband_pct &lt;- getCensus(name = &quot;acs/acs5/subject&quot;, vintage = 2018,
                               vars = c(&quot;S2801_C02_017E&quot;,&quot;S2801_C02_019E&quot;,&quot;S2801_C02_016E&quot;,&quot;S2801_C02_018E&quot;),
                               region = &quot;county:*&quot;,
                               regionin = &quot;state:20,23,48&quot;)

# Rename variables #
acs_broadband_pct &lt;- acs_broadband_pct %&gt;% 
  rename(pct_cellular_acs_2018 = S2801_C02_016E,
         pct_fixed_acs_2018 = S2801_C02_017E,
         pct_sat_acs_2018 = S2801_C02_018E,
         pct_nobroadband_acs_2018 = S2801_C02_019E) %&gt;% 
  mutate(pct_anybroadband_acs_2018 = 100 - pct_nobroadband_acs_2018,
         county_FIPS = paste(state, county, sep = &quot;&quot;))

acs_broadband_pct_tx &lt;- acs_broadband_pct %&gt;% 
  filter(state == &quot;48&quot;)</code></pre>
<pre class="r"><code>## Educational Attainment and Industry Profile, Self-employment from the ACS 2018 ##
acs_demo &lt;- getCensus(name = &quot;acs/acs5/profile&quot;, vintage = 2018,
                      vars = c(&quot;DP02_0066PE&quot;,&quot;DP02_0064PE&quot;,&quot;DP02_0065PE&quot;, # Educational attainment
                               &quot;DP03_0033PE&quot;,&quot;DP03_0034PE&quot;,&quot;DP03_0035PE&quot;,&quot;DP03_0036PE&quot;,&quot;DP03_0037PE&quot;,
                               &quot;DP03_0038PE&quot;,&quot;DP03_0039PE&quot;,&quot;DP03_0040PE&quot;,&quot;DP03_0041PE&quot;,&quot;DP03_0042PE&quot;,
                               &quot;DP03_0043PE&quot;,&quot;DP03_0044PE&quot;,&quot;DP03_0045PE&quot;, # Industry profile
                               &quot;DP03_0049PE&quot;),
                      region = &quot;county:*&quot;,
                      regionin = &quot;state:20,23,48&quot;)

# Rename variables #
acs_demo &lt;- acs_demo %&gt;% 
  mutate(DP02_0066PE = 100 - DP02_0066PE) %&gt;% # Substract from 100 to get % of ppl less than highschool
  rename(pctlessthanhigh_2019 = DP02_0066PE,
         pctbachelors_2019 = DP02_0064PE,
         pctgraduate_2019 = DP02_0065PE,
         pctagriculture_2019 = DP03_0033PE, pctconstruction_2019 = DP03_0034PE, pctmanufacture_2019 = DP03_0035PE,
         pctwholesale_2019 = DP03_0036PE, pctretail_2019 = DP03_0037PE, pcttransportation_2019 = DP03_0038PE,
         pctinformation_2019 = DP03_0039PE, pctfinance_2019 = DP03_0040PE, pctprofessional_2019 = DP03_0041PE,
         pctedu_healthcare_social_2019 = DP03_0042PE, pctarts_ent_2019 = DP03_0043PE,
         pctpublic_admin_2019 = DP03_0045PE, pctother_occupation_2019 = DP03_0044PE,
         pct_self_employed_2019 = DP03_0049PE) %&gt;% 
  mutate(county_FIPS = paste0(state, county)) %&gt;% 
  select(-c(state, county))

## Age Group of 2019 from the Population Estimates ##
pep_agegroup &lt;- getCensus(name = &quot;pep/charagegroups&quot;,
                          vintage = 2019,
                          vars = c(&quot;POP&quot;,&quot;AGEGROUP&quot;),
                          region = &quot;county:*&quot;,
                          regionin = &quot;state:20,23,48&quot;)

pep_agegroup &lt;- pep_agegroup %&gt;% 
  mutate(county_FIPS = paste0(state, county)) %&gt;% 
  spread(AGEGROUP, POP) %&gt;% 
  set_names(paste0(&quot;x_&quot;, names(.))) %&gt;% 
  rename(county_FIPS = x_county_FIPS) %&gt;% 
  mutate_at(vars(starts_with(&quot;x_&quot;)), funs(as.numeric)) %&gt;% 
  mutate(pctboomers_2019 = (x_12 + x_13 + x_14 + x_15) / x_0,
         pctgenx_2019 = (x_8 + x_9 + x_10 + x_11) / x_0,
         pctmilennial_2019 = (x_5 + x_6 + x_7 + x_8) / x_0,
         population_2019 = x_0) %&gt;%  
  select(county_FIPS, pctboomers_2019, pctgenx_2019, pctmilennial_2019, population_2019)

## Merge Demographic Control Variables ##
demo_cont &lt;- left_join(pep_agegroup, acs_demo, by = &quot;county_FIPS&quot;)</code></pre>
</div>
<div id="fcc-477-broadband-availability-for-year-2019" class="section level2">
<h2>FCC 477 Broadband Availability for Year 2019</h2>
<p>I will here retrieve the most up to date FCC 477 broadband data as of June 2019. In order to interact with FCC broadband data directly through its API, one needs to register for the FCC data portal as well as personal API key. Instructions can be found <a href="https://dev.socrata.com/foundry/opendata.fcc.gov/sgz3-kiqt">here</a>. Package used to interact with the data is <code>RSocrata</code>.</p>
<p>Alternative to using the API, we could also download the dataset directly from FCC website using the URLs. As API interaction did not work properly at the time of writing this, we will retreive data directly from the URL.</p>
<p>Using the raw data, We will generate:</p>
<ul>
<li><code>pct_bb_fcc_2019</code>: % of broadband availability at the speed of 25/3 per county</li>
<li><code>pct_bb_fcc_50-5_2019</code>: % of broadband availability at the speed of 50/5 per county</li>
<li><code>pct_bb_fcc_100-10_2019</code>: % of broadband availability at the speed of 100/10 per county</li>
<li><code>pct_bb_fcc_250-25_2019</code>: % of broadband availability at the speed of 250/25 per county</li>
</ul>
<pre class="r"><code>install.packages(&quot;RSocrata&quot;)
library(RSocrata)

## Retrieve FCC 477 data of TX using API##

fcc477_2019_raw &lt;- read.socrata(
  &quot;https://opendata.fcc.gov/resource/sgz3-kiqt.csv?stateabbr=TX&quot;,
  app_token = &quot;YOUR API KEY&quot;,
  email = &quot;ID&quot;,
  password = &quot;password&quot;
)</code></pre>
<pre class="r"><code>#### Import FCC 477 Data of Three States from URL ####

## Write query for three states ME, KS, TX
# Create temporary file space to download the dataset
temp &lt;- tempfile()
temp2 &lt;- tempfile()
# Download dataset for each state, unzip and import to data frame
# Texas as of June 2019
download.file(&quot;https://transition.fcc.gov/form477/BroadbandData/Fixed/Jun19/Version%201/TX-Fixed-Jun2019.zip&quot;, temp)
unzip(zipfile = temp, exdir = temp2)
fcc477_2019_tx &lt;- read.csv(file.path(temp2, &quot;TX-Fixed-Jun2019-v1.csv&quot;), header = T)
# Kansas as of June 2019
download.file(&quot;https://transition.fcc.gov/form477/BroadbandData/Fixed/Jun19/Version%201/KS-Fixed-Jun2019.zip&quot;, temp)
unzip(zipfile = temp, exdir = temp2)
fcc477_2019_ks &lt;- read.csv(file.path(temp2, &quot;KS-Fixed-Jun2019-v1.csv&quot;), header = T)
# Maine as of June 2019
download.file(&quot;https://transition.fcc.gov/form477/BroadbandData/Fixed/Jun19/Version%201/ME-Fixed-Jun2019.zip&quot;, temp)
unzip(zipfile = temp, exdir = temp2)
fcc477_2019_me &lt;- read.csv(file.path(temp2, &quot;ME-Fixed-Jun2019-v1.csv&quot;), header = T)

# Bind into one
fcc477_Jun2019_txksme &lt;- rbind(fcc477_2019_tx, fcc477_2019_ks, fcc477_2019_me)

## Import FCC Staff&#39;s block estimates ##
## The dataset provides FCC&#39;s estimates of population, households, and housing units per census block ##
## The links are available at https://www.fcc.gov/reports-research/data/staff-block-estimates ##
download.file(&quot;https://www.fcc.gov/file/17838/download&quot;, temp)
unzip(zipfile = temp, exdir = temp2)
fcc_staff_est_us2018 &lt;- read.csv(file.path(temp2, &quot;us2018.csv&quot;), header = T)

fcc_staff_est_county2018 &lt;- read.csv(&quot;https://www.fcc.gov/file/17821/download&quot;, header = T)
unlink(temp)
unlink(temp2)
rm(temp)
rm(temp2)

#### Clean Dataset ####
fcc477_Jun2019_txksme &lt;- fcc477_Jun2019_txksme %&gt;% 
  mutate(BlockCode = as.character(BlockCode),
         TechCode = as.character(TechCode),
         Consumer = as.character(Consumer)) %&gt;% 
  select(Provider_Id, ProviderName, StateAbbr, BlockCode, TechCode, Consumer, MaxAdDown, MaxAdUp) %&gt;% 
  mutate(county_fips = str_sub(BlockCode, 1, 5)) %&gt;% 
  filter(TechCode != c(&quot;60&quot;))

## Staff Estimates for US Census Block Level ##
fcc_staff_est_us2018 &lt;- fcc_staff_est_us2018 %&gt;% 
  mutate(block_fips = as.character(block_fips),
         county_fips = str_sub(block_fips, 1, 5)) %&gt;% 
  select(stateabbr, county_fips, block_fips, ends_with(&quot;2018&quot;))

## County Level Staff Estimates ##
fcc_staff_est_county2018 &lt;- fcc_staff_est_county2018 %&gt;% 
  select(Id, Id2, Geography, ends_with(&quot;2018&quot;)) %&gt;% 
  rename(hu2018 = `Housing.Unit.Estimate..as.of.July.1....2018`,
         pop2018 = `Population.Estimate..as.of.July.1....2018`)

#### Calculating the Broadband Availability ####
## General process:
## 1. Code blocks based on presence of broadband service at 25/3 Mbps level
## 2. If the block has 25/3 Mbps service the block is considered to have broadband availability
## 3. Aggregate at the county level
## 4. Merge with staff estimates and calculate percentages

### Data as of June 2019 ###
# Step 1 Code blocks based on persence of broadband service (25/3)
fcc477_Jun2019_txksme &lt;- fcc477_Jun2019_txksme %&gt;% 
  mutate(broadband_f = as.factor(ifelse(MaxAdDown &gt;= 25 &amp; MaxAdUp &gt;= 3, 1, 0)),
         bb_50_5_f = as.factor(ifelse(MaxAdDown &gt;= 50 &amp; MaxAdUp &gt;= 5, 1, 0)),
         bb_100_10_f = as.factor(ifelse(MaxAdDown &gt;= 100 &amp; MaxAdUp &gt;= 10, 1, 0)),
         bb_250_25_f = as.factor(ifelse(MaxAdDown &gt;= 250 &amp; MaxAdUp &gt;= 25, 1, 0)))
# Join the staff estimates and filter only consumer services
fcc477_Jun2019_txksme &lt;- fcc477_Jun2019_txksme %&gt;% 
  left_join(., fcc_staff_est_us2018, by = c(&quot;BlockCode&quot; = &quot;block_fips&quot;)) %&gt;% 
  filter(Consumer == 1)

# Aggregate at the census block level
# Summing the broadband factor variable would let us know if there is a census block with broadband
# availability or not (if there are, the sum would be greater than 0, if there is non, sum would be 0)
fcc477_txksme_block_1 &lt;- fcc477_Jun2019_txksme %&gt;% 
  filter(broadband_f == &quot;1&quot;) %&gt;% 
  distinct(BlockCode, .keep_all = T)
fcc477_txksme_block_2 &lt;- fcc477_Jun2019_txksme %&gt;% 
  filter(bb_50_5_f == &quot;1&quot;) %&gt;% 
  distinct(BlockCode, .keep_all = T)
fcc477_txksme_block_3 &lt;- fcc477_Jun2019_txksme %&gt;% 
  filter(bb_100_10_f == &quot;1&quot;) %&gt;% 
  distinct(BlockCode, .keep_all = T)
fcc477_txksme_block_4 &lt;- fcc477_Jun2019_txksme %&gt;% 
  filter(bb_250_25_f == &quot;1&quot;) %&gt;% 
  distinct(BlockCode, .keep_all = T)

# Aggregate at the county level and merge with FCC staff estimates
fcc477_txksme_county_1 &lt;- fcc477_txksme_block_1 %&gt;% 
  group_by(county_fips.x) %&gt;% summarise(pop_bb_county2018 = sum(pop2018)) %&gt;% 
  left_join(., fcc_staff_est_county2018, by = c(&quot;county_fips.x&quot; = &quot;Id2&quot;))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>fcc477_txksme_county_2 &lt;- fcc477_txksme_block_2 %&gt;% 
  group_by(county_fips.x) %&gt;% summarise(pop_bb_county2018 = sum(pop2018)) %&gt;% 
  left_join(., fcc_staff_est_county2018, by = c(&quot;county_fips.x&quot; = &quot;Id2&quot;))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>fcc477_txksme_county_3 &lt;- fcc477_txksme_block_3 %&gt;% 
  group_by(county_fips.x) %&gt;% summarise(pop_bb_county2018 = sum(pop2018)) %&gt;% 
  left_join(., fcc_staff_est_county2018, by = c(&quot;county_fips.x&quot; = &quot;Id2&quot;))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>fcc477_txksme_county_4 &lt;- fcc477_txksme_block_4 %&gt;% 
  group_by(county_fips.x) %&gt;% summarise(pop_bb_county2018 = sum(pop2018)) %&gt;% 
  left_join(., fcc_staff_est_county2018, by = c(&quot;county_fips.x&quot; = &quot;Id2&quot;))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>#### Calculating FCC Deployment Percentages ####
## 477 Data as of June 2019 &amp; Staff Estimates as of 2018 ##
# Calculate broadband percentage by dividing census block population with broadband by total county
# population
fcc477_txksme_county_1 &lt;- fcc477_txksme_county_1 %&gt;% 
  mutate(pct_bb_fcc_2019 = pop_bb_county2018 / pop2018)
fcc477_txksme_county_2 &lt;- fcc477_txksme_county_2 %&gt;% 
  mutate(pct_bb_fcc_50_5_2019 = pop_bb_county2018 / pop2018)
fcc477_txksme_county_3 &lt;- fcc477_txksme_county_3 %&gt;% 
  mutate(pct_bb_fcc_100_10_2019 = pop_bb_county2018 / pop2018)
fcc477_txksme_county_4 &lt;- fcc477_txksme_county_4 %&gt;% 
  mutate(pct_bb_fcc_250_25_2019 = pop_bb_county2018 / pop2018)

fcc477_txksme_county &lt;- fcc477_txksme_county_1 %&gt;% 
  left_join(., select(fcc477_txksme_county_2, county_fips.x, pct_bb_fcc_50_5_2019),
            by = c(&quot;county_fips.x&quot;)) %&gt;% 
  left_join(., select(fcc477_txksme_county_3, county_fips.x, pct_bb_fcc_100_10_2019),
            by = c(&quot;county_fips.x&quot;)) %&gt;% 
  left_join(., select(fcc477_txksme_county_4, county_fips.x, pct_bb_fcc_250_25_2019),
            by = c(&quot;county_fips.x&quot;)) %&gt;% 
  select(county_fips.x, pct_bb_fcc_2019, pct_bb_fcc_50_5_2019, pct_bb_fcc_100_10_2019, pct_bb_fcc_250_25_2019)

fcc477_txksme_county[is.na(fcc477_txksme_county)] &lt;- 0</code></pre>
<p>Now we will merge these datasets by county FIPS numbers altogether</p>
<pre class="r"><code>## Create a V2 merged dataset ##
tx_bb_entrepreneur_merged_v2 &lt;- tx_bb_entrepreneur_merged %&gt;%  
  left_join(., cbp_txksme, by = c(&quot;county_FIPS&quot; = &quot;county_FIPS&quot;)) %&gt;% 
  left_join(., nonemp_txksme, by = c(&quot;county_FIPS&quot; = &quot;county_FIPS&quot;)) %&gt;% 
  left_join(., acs_broadband_pct, by = c(&quot;county_FIPS&quot; = &quot;county_FIPS&quot;)) %&gt;% 
  left_join(., bea_nonfarmproprietor_txksme, by = c(&quot;county_FIPS&quot; = &quot;GeoFips&quot;)) %&gt;% 
  left_join(., firmlevel_txksme, by = c(&quot;county_FIPS&quot; = &quot;county_FIPS&quot;)) %&gt;% 
  left_join(., select(rucc2013, c(&quot;FIPS&quot;,&quot;RUCC_2013&quot;,&quot;metro_desc&quot;)), by = c(&quot;county_FIPS&quot; = &quot;FIPS&quot;)) %&gt;% 
  left_join(., demo_cont, by = c(&quot;county_FIPS&quot; = &quot;county_FIPS&quot;))

## Generate average GoDaddy &amp; M-lab broadband measures and clean unnecessary variables ##
tx_bb_entrepreneur_merged_v2 &lt;- tx_bb_entrepreneur_merged_v2 %&gt;% 
  mutate(venturedensity_mean = rowMeans(select(., c(venturedensitymay18, venturedensitynov18, venturedensityfeb19, venturedensitysep19, venturedensityoct19, venturedensitynov19, venturedensitydec19)), na.rm = T),
         highlyactive_vd_mean = rowMeans(select(., c(highlyactive_vdmay18, highlyactive_vdnov18, highlyactive_vdfeb19, highlyactive_vdsep19, highlyactive_vdoct19, highlyactive_vdnov19, highlyactive_vddec19)), na.rm = T),
         pct_broadband_mlab = rowMeans(select(., c(frac_BB.sept, frac_BB.oct, frac_BB.nov, frac_BB.dec)), na.rm = T)) %&gt;% 
  select(-c(starts_with(&quot;frac_under_&quot;), starts_with(&quot;frac_over&quot;), starts_with(&quot;samples.&quot;), starts_with(&quot;BB_samples&quot;), state, county.y, starts_with(&quot;DL&quot;), starts_with(&quot;UL&quot;), starts_with(&quot;dl_sample&quot;), starts_with(&quot;ul_sample&quot;)))

tx_bb_entrepreneur_merged_v2 &lt;- tx_bb_entrepreneur_merged_v2 %&gt;% 
  left_join(., fcc477_txksme_county, by = c(&quot;county_FIPS&quot; = &quot;county_fips.x&quot;))

## Modify nonemployer percentage - Nonemployer share over total employment
tx_bb_entrepreneur_merged_v2 &lt;- tx_bb_entrepreneur_merged_v2 %&gt;% 
  mutate(pct_nonfarmneest_nemp_2018 = nonfarmneest_nemp_2018 / totalemp_bea_2018,
         pct_nonfarmneest_nemp_2012 = nonfarmneest_nemp_2012 / totalemp_bea_2012,
         pct_nonfarmneest_nemp_2012 = ifelse(is.na(pct_nonfarmneest_nemp_2012) | is.infinite(pct_nonfarmneest_nemp_2012),NA, pct_nonfarmneest_nemp_2012),
         pct_nonfarmneest_nemp_2018 = ifelse(is.na(pct_nonfarmneest_nemp_2018) | is.infinite(pct_nonfarmneest_nemp_2018),NA, pct_nonfarmneest_nemp_2018),
         metro_f = as.factor(metro_desc),
         pctagriculture_2019 = pctagriculture_2019/100,
         pctconstruction_2019 = pctconstruction_2019/100,
         pctmanufacture_2019 = pctmanufacture_2019/100,
         pctwholesale_2019 = pctwholesale_2019/100,
         pctretail_2019 = pctretail_2019/100,
         pcttransportation_2019 = pcttransportation_2019/100,
         pctinformation_2019 = pctinformation_2019/100,
         pctfinance_2019 = pctfinance_2019/100,
         pctprofessional_2019 = pctprofessional_2019/100,
         pctedu_healthcare_social_2019 = pctedu_healthcare_social_2019/100,
         pctother_occupation_2019 = pctother_occupation_2019/100,
         pctpublic_admin_2019 = pctpublic_admin_2019/100,
         pctlessthanhigh_2019 = pctlessthanhigh_2019/100, pctbachelors_2019 = pctbachelors_2019/100,
         pctgraduate_2019 = pctgraduate_2019/100) 

## Create industry diversity index following equations used by Alesina et al. (1999) and Gallardo et al. (2020)
## The equation is Industry = 1 - sum(ind_share^2)

tx_bb_entrepreneur_merged_v2 &lt;- tx_bb_entrepreneur_merged_v2 %&gt;% 
  mutate(indstry_diversity = 1 - (pctagriculture_2019^2 + pctconstruction_2019^2 + pctmanufacture_2019^2 +
                                    pctwholesale_2019^2 + pctretail_2019^2 + pcttransportation_2019^2 +
                                    pctinformation_2019^2 + pctfinance_2019^2 + pctprofessional_2019^2 +
                                    pctedu_healthcare_social_2019^2 + pctother_occupation_2019^2 +
                                    pctpublic_admin_2019^2))

## Write CSV ##
write_csv(tx_bb_entrepreneur_merged_v2, &quot;Broadband-Entrepreneurship-TXKSME.csv&quot;)</code></pre>
</div>

<p>Copyright &copy; 2020 Jaewon Royce Choi, Technology & Information Policy Institute (TIPI). All rights reserved.</p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
